## 磁盘分区 （MBR)

> 1. 最多4个主分区（主分区，扩展分区）
> 2. 逻辑分区从5开始标记
> 3. 只能识别2TB之内的磁盘

> 虚拟机添加完磁盘后，使用`fdisk -l`无法立即识别，
> 可以使用下面命令，激活扫描后，即可识别到新增磁盘
> `echo "- - -" > /sys/class/scsi_host/host0/scan`

1. `fdisk` 磁盘分区命令

   - `fdisk -l` 列出所有分区

   ```bash
   [root@centos7 ~]# fdisk -l
   
   Disk /dev/sda: 21.5 GB, 21474836480 bytes, 41943040 sectors
   Units = sectors of 1 * 512 = 512 bytes
   Sector size (logical/physical): 512 bytes / 512 bytes
   I/O size (minimum/optimal): 512 bytes / 512 bytes
   Disk label type: dos
   Disk identifier: 0x000ac4a8
   
      Device Boot      Start         End      Blocks   Id  System
   /dev/sda1   *        2048     2099199     1048576   83  Linux
   /dev/sda2         2099200     6293503     2097152   82  Linux swap / Solaris
   /dev/sda3         6293504    41943039    17824768   83  Linux
   
   Disk /dev/sdb: 21.5 GB, 21474836480 bytes, 41943040 sectors
   Units = sectors of 1 * 512 = 512 bytes
   Sector size (logical/physical): 512 bytes / 512 bytes
   I/O size (minimum/optimal): 512 bytes / 512 bytes
   
   
   Disk /dev/sdc: 5368.7 GB, 5368709120000 bytes, 10485760000 sectors
   Units = sectors of 1 * 512 = 512 bytes
   Sector size (logical/physical): 512 bytes / 512 bytes
   I/O size (minimum/optimal): 512 bytes / 512 bytes
   ```

   - `fdisk /dev/sdb` 磁盘分区。交互式命令

   ```bash
   [root@centos7 ~]# fdisk /dev/sdb
   Welcome to fdisk (util-linux 2.23.2).
   
   Changes will remain in memory only, until you decide to write them.
   Be careful before using the write command.
   
   Device does not contain a recognized partition table
   Building a new DOS disklabel with disk identifier 0x7638002c.
   
   Command (m for help): m
   Command action
      a   toggle a bootable flag
      b   edit bsd disklabel
      c   toggle the dos compatibility flag
      d   delete a partition
      g   create a new empty GPT partition table
      G   create an IRIX (SGI) partition table
      l   list known partition types
      m   print this menu
      n   add a new partition
      o   create a new empty DOS partition table
      p   print the partition table
      q   quit without saving changes
      s   create a new empty Sun disklabel
      t   change a partition's system id
      u   change display/entry units
      v   verify the partition table
      w   write table to disk and exit
      x   extra functionality (experts only)
   ```

   - - 新建分区：`n`

     >n:新建分区
     >
     >p：选择创建主分区

     ```bash
     Command (m for help): n
     Partition type:
        p   primary (0 primary, 0 extended, 4 free)
        e   extended
     Select (default p): p
     Partition number (1-4, default 1): 
     First sector (2048-41943039, default 2048): 
     Using default value 2048
     Last sector, +sectors or +size{K,M,G} (2048-41943039, default 41943039): +5G
     Partition 1 of type Linux and of size 5 GiB is set
     ```

   - - 查看分区表：`p`

     ```
     Command (m for help): p
     
     Disk /dev/sdb: 21.5 GB, 21474836480 bytes, 41943040 sectors
     Units = sectors of 1 * 512 = 512 bytes
     Sector size (logical/physical): 512 bytes / 512 bytes
     I/O size (minimum/optimal): 512 bytes / 512 bytes
     Disk label type: dos
     Disk identifier: 0x7638002c
     
        Device Boot      Start         End      Blocks   Id  System
     /dev/sdb1            2048    10487807     5242880   83  Linux
     ```

   - - 新建扩展分区
   - - 新建逻辑分区（分区号从5开始）
   - - 分区完成后，写入分区表：`w`

2. `mkfs`：创建文件系统

   > `mkfs -t xfs` 或 `mkfs.xfs`

   ```bash
   [root@centos7 ~]# mkfs -t <Tab>
   btrfs   cramfs  ext2    ext3    ext4    minix   xfs     
   [root@centos7 ~]# mkfs -t xfs /dev/sdb1
   meta-data=/dev/sdb1              isize=512    agcount=4, agsize=327680 blks
            =                       sectsz=512   attr=2, projid32bit=1
            =                       crc=1        finobt=0, sparse=0
   data     =                       bsize=4096   blocks=1310720, imaxpct=25
            =                       sunit=0      swidth=0 blks
   naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
   log      =internal log           bsize=4096   blocks=2560, version=2
            =                       sectsz=512   sunit=0 blks, lazy-count=1
   realtime =none                   extsz=4096   blocks=0, rtextents=0
   ```

3. `mount`：挂载分区

   > 将已创建文件系统的分区挂载到指定目录（相当于windows下分配盘符）
   >
   > 前提：指定的目录必须事先创建

   ```bash
   [root@centos7 ~]# mkdir /data
   [root@centos7 ~]# mount /dev/sdb1 /data
   [root@centos7 ~]# df -l
   Filesystem     1K-blocks    Used Available Use% Mounted on
   devtmpfs          421624       0    421624   0% /dev
   tmpfs             432284       0    432284   0% /dev/shm
   tmpfs             432284    1484    430800   1% /run
   tmpfs             432284       0    432284   0% /sys/fs/cgroup
   /dev/sda3       17814528 3006372  14808156  17% /
   /dev/sda1        1038336  214388    823948  21% /boot
   tmpfs              86460       0     86460   0% /run/user/0
   /dev/sdb1        5232640   32992   5199648   1% /data
   ```

4. `df`：（disk free)查看文件系统及磁盘使用量（显示已挂载分区信息）

   > -l :查看文件系统
   >
   > -h：以易阅读的方式形式

   ```bash
   [root@centos7 ~]# df -lh
   Filesystem      Size  Used Avail Use% Mounted on
   devtmpfs        412M     0  412M   0% /dev
   tmpfs           423M     0  423M   0% /dev/shm
   tmpfs           423M  1.5M  421M   1% /run
   tmpfs           423M     0  423M   0% /sys/fs/cgroup
   /dev/sda3        17G  2.9G   15G  17% /
   /dev/sda1      1014M  210M  805M  21% /boot
   tmpfs            85M     0   85M   0% /run/user/0
   /dev/sdb1       5.0G   33M  5.0G   1% /data
   ```

5. `lsblk`：(list block)查看系统磁盘使用情况（所有分区）

   ```bash
   [root@centos7 ~]# lsblk 
   NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
   sda      8:0    0   20G  0 disk 
   ├─sda1   8:1    0    1G  0 part /boot
   ├─sda2   8:2    0    2G  0 part [SWAP]
   └─sda3   8:3    0   17G  0 part /
   sdb      8:16   0   20G  0 disk 
   ├─sdb1   8:17   0    5G  0 part /data
   └─sdb2   8:18   0    3G  0 part 
   sdc      8:32   0  4.9T  0 disk 
   sr0     11:0    1 1024M  0 rom  
   ```

   > -f :查看文件系统信息

   ```bash
   [root@centos7 ~]# lsblk -f
   NAME   FSTYPE LABEL UUID                                 MOUNTPOINT
   sda                                                      
   ├─sda1 xfs          024a48be-d988-4e43-ad14-73a2658ecd05 /boot
   ├─sda2 swap         79624854-ef12-47e3-bc67-977a3bb7ebf0 [SWAP]
   └─sda3 xfs          8af721ba-6998-4b36-83ce-ab1b8e306976 /
   sdb                                                      
   ├─sdb1 xfs          8ce68bcc-d04f-4c5e-b4b4-011e9c531459 /data
   └─sdb2 xfs          0038415b-7764-4940-82e6-332dedc5b9a5 
   sdc                                                      
   sr0                            
   ```

   计算机存储容量单位：1B=8bit；1KB=1024B；1MB=1024KB；1GB=1024MB；1TB=1024GB；1PB=1024TB；1EB=1024PB；1ZB=1024EB；1YB=1024ZB；1NB=1024YB；1DB=1024NB；1CB=1024DB。